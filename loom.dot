{@ traces, funcs}
{%
	local loom = require 'jit.loom'
	local funcinfo = require ('jit.util').funcinfo
%}
digraph G {
	{% for i, tr in loom.allipairs(traces) do %}
		{% local entryinfo = funcinfo(tr.rec[1][1], tr.rec[1][2]) %}
		{{: '\n\tT%d [label=%q];', i, entryinfo.loc }}
	{% end %}

	{% for i, tr in loom.allipairs(traces) do %}
		{% if false and tr.info.linktype == 'loop' then %}
			{{: '\n\tT%d -> T%d;', i, i}}
		{% end %}
		{% if tr.parent and tr.p_exit then %}
			{{: '\n\tT%d -> T%d [label="%s"];', tr.parent, i, tr.p_exit}}
		{% end %}
		{% if tonumber(tr.info.link) then %}
			{{: '\n\tT%d -> T%d;', i, tr.info.link}}
		{% end %}
	{% end %}

}
